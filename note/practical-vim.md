# 《Vim 实用技巧》笔记

Tip 1：使用.（英文点号）“重复上一次修改”

```
vim会记录上一次修改
所谓上一次修改包括：

* 在普通模式下执行的一个命令
* 进入编辑模式到退出便捷模式之间执行到一系列操作

```

Tip 2：不要自我重复

```
用复合命令替换长命令
C c$
s cl
S ^c
I ^i
A $a
o A<CR>
O ko
...
```

Tip 3：以退为进

```
s 替换 :先删除光标下字符在输入替换字符
f{char} :查找下一处指定字符出现到位置
; :重复上一次f命令查找到字符
```

Tip 4：执行、重复、回退

| 目的                     | 操作                  | 重复   | 回退   |
|:------------------------ |:---------------------:|:------:|:------:|
| 做出一个修改             | {edit}                | .      | u      |
| 在行内查找下一指定字符   | f{char}/t{char}       | ;      | ,      |
| 在行内查找上一指定字符   | F{char}/T{char}       | ;      | ,      |
| 在文档中查找下一处匹配项 | /pattern<CR>          | n      | N      |
| 在文档中查找上一处匹配项 | ?patthrn<CR>          | n      | N      |
| 执行替换                 | :s/target/replacement | &      | u      |
| 执行一系列修改           | qx{changes}q          | @x     | u      |

Tip 5：查找并手动替换

```
* :在当前单词上使用*命令，会在文档中查找当前单词，并跳到下一个匹配项上边
```

Tip 6：结识.范式

```
理想模式：用一键移动，另一键执行
```

Tip 7：停顿时请一开画笔（大部分时间都停留在普通模式下）

Tip 8：把撤销单元切成块

```
* 控制好<Esc>键的使用
* 在插入模式中使用了<Up> <Down> <Left> <Right>这些光标键将会产生一个新的撤销块
```

Tip 9：构造可重复的修改

```
思考 dbx bdw daw 的区别？
```

Tip 10：用次数做简单的算数运算

```
[count]<C-a> ：就近对数字加上count
[count]<C-x> ：就近对数字减去count
set nrformats= ：让Vim把所有数字都当成十进制
```

Tip 11：能够重复，就别用次数

```
思考 d2w 2dw dw. 哪个好点？
只在必要时使用次数
```

Tip 12：双剑合璧，天下无敌（这标题取得...）

```
操作符+动作命令=操作

命令 用途
c 修改
d 删除
y 复制到寄存器
g～ 反转大小写
gu 转换为小写
gU 转换为大写
> 增加缩进
< 减小缩进
= 自动缩进
! 使用外部程序过滤{motion}所跨越的行
```

Tip 13：在插入模式中可即时更正错误

```
<C-h> 删除前一个字符
<C-w> 删除前一个单词
<C-u> 删除至行首
```

Tip 14：返回普通模式

```
<Esc> 切换到普通模式
<C-[> 切换到普通模式
<C-o> 切换到插入-普通模式

经常会使用<C-o>zz
```

Tip 15：不离开插入模式，粘贴寄存器中的文本

```
重新映射 Caps Lock 键
<C-r>{register} 很方便的粘贴几个单词
<C-r><C-p>{register} 按原义插入寄存器内的文本并修正任何不必要的缩进
```

Tip 16：随时随地做运算

```
在插入模式中输入<C-r>=
输入要执行的表达式
<CR>
```

Tip 17：用字符编码插入非常用字符

```
在插入模式中输入<C-v>{code}，其中{code}是需要插入的字符。
如果想知道文档中任意字符的编码，只需要把光标移到它上面并按ga命令，然后屏幕下方就会显示出一条消息，分别以十进制和十六进制的形式显示出其字符编码。
```

Tip 18：用二合字母插入非常用字符

```
在插入模式中，只需要输入<C-k>{char1}{char2}
```

Tip 19：用替换模式替换已有文本

```
用R命令可以由普通模式进入替换模式
gR命令可以出发虚拟替换模式
```

Tip 20：深入理解可视模式

```
按<C-g>可以在可视模式及选择模式间切换，切换后唯一的不同是屏幕下方提示信息。但是如果在选择模式中输入任意可见字符的话，此字符会替换所选内容并切换到插入模式。
```

Tip 21：选择高亮选区

```
三种模式
v 激活面向字符的可视模式
V 激活面向行的可视模式
<C-v> 激活面向列块的可视模式
gv 重选上次的高亮选区

切换命令
<Esc> or <C-[>    回到普通模式
v or V or <C-v>   切换到普通模式(当前是面向字符/面向行/面向块的可视模式时)
v
V
<C-v>
o    切换高亮选区的活动端（可视模式区域两个端点间切换）
```

Tip 22：重复执行面向行的可视命令

```
不多说，就是.命令在可视模式下的应用
```

Tip 23：只要可能，最好用操作符命令，而不是可视命令

Tip 24：用面向列块的可视模式编辑表格数据

Tip 25：修改列文本

Tip 26：在长短不一的高亮块后添加文本

```
可视模式中对 i a 和 I A的约定
```

Tip 27：Vim的命令行模式

```
普通模式下，按下:键时，Vim会切换到命令行模式，这个模式和shell下命令行有些类似，我们可以输入一条命令，然后按<CR>执行他。

操作缓冲区文本的Ex命令
:[range]delete [x]
:[range]yank [x]
:[line]put [x]
:[range]copy {address}
:[range]move {address}
:[range]join
:[range]normal {commands}
:[range]substitute/{pattern}/{string}/[flags]
:[range]global/{pattern}/[cmd]

有些命令在插入模式和命令行模式中可以通用
<C-w>
<C-u>
<C-v>
<C-k>
<C-r>{register}
```

Tip 28：在一行或多个连续行上执行命令

```
Ex 命令可以用 [range] 指定要操作的范围

* 我们可以用行号、位置标记或是查找模式来指定范围的开始位置及结束位置，特殊的是0虚拟行，位于文件第一行上方
* 用地址指定一个范围 {start},{end}，符号.代表当前行地址，符号%代表当前文件中的所有行
* 用高亮选区指定范 '<,'>
* 用模式指定范围 /<html>/,/<\/html>/
* 用偏移地址进行修正 /<html>/+1,/<\/html>/-1
```

Tip 29：使用 :t 和 :m 命令复制和移动行

```
:[range]copy {address}

:[range]move {address}
```

Tip 30：在指定范围上执行普通模式命令

```
:normal
```

Tip 31：重复上次的Ex命令

```
如果想重复上次的Ex命令，使用@:
:寄存器总是保存着最后执行的命令，在运行过一次@:之后，后边就可以使用@@来重复他
:bn[ext] 遍历缓冲区列表的条目时正向移动
:bp[revious] 遍历缓冲区列表的条目时反向移动
```

Tip 32：自动补全Ex命令

```
<C-d> 显示可用的补全列表，<Tab>依次选中可用的补全命令，<S-Tab>反向选中
调整 wildmode 选项可以自定义补全行为
```

Tip 33：把当前单词插入到命令行

```
在命令行下，<C-r><C-w>映射项会复制光标下的单词把它插入到命令行中。
如果想插入光标下的字串，可以用<C-r><C-a>
```

Tip 34：回溯历史命令

```
先按:切换到命令行模式，在保持提示符为空的情况下按<Up>键，此时最后执行的那条Ex命令就会被填充到命令行上。再接着按<Up>键的话，就可以回到更早的Ex历史命令；按<Down>键的话，则沿相反方向滚动。
如果提示符下有内容，则只会匹配以这些内容开头的历史命令。
通过修改 history 选项，可以设置保存命令的上限（会保存在.vimrc里，后续使用vim仍然生效）
Vim 不仅会记录Ex命令历史，也会为查找历史单独保存一份历史记录。

q/ 打开查找命令历史到命令行窗口
q: 进入命令行窗口
<C-f> 从命令行模式切换到命令行窗口
```

Tip 35：运行Shell命令

```
命令行模式中，给命令加一个!前缀就可以调用外部程序。

* 在命令行中 % 代表文件名

* :!{cmd} 这种语法适用与执行一次性命令；:shell命令用来启动一个交互到shell会话，exit命令可以退出此shell并返回vim。
* 也可以把Vim置于后台，可以用Ctrl-z挂起Vim所属进程，并把控制权交还给bash，后续用fg命令唤醒被挂起到Vim作业。

* :read !{cmd} 把{cmd}命令的输出读入当前缓冲区
* :write !{cmd} 把当前缓冲区内容作为指定{cmd}的标准输入

* 当给定一个范围时，:!{cmd}有不同的含义，有[range]所指定的行会传给{cmd}作为标准输入，然后又会用{cmd}的输出覆盖[range]内的原本内容。
* Vim 提供了一种方便的快捷方式来设置:[range]!{filter}命令中的范围，可以用!{motion}操作符切换到命令行模式，并把指定{motion}所涵盖到范围预置在命令行上。
```

Tip 36：用缓冲区列表管理打开的文件

Tip 37：用参数列表将缓冲区分组

Tip 38：管理隐藏缓冲区

```
:w[rite]    把缓冲区写入磁盘
:e[dit]!    把磁盘文件读入缓冲区（即回滚所做的修改）
:qa[all]!   关闭所有窗口，摒弃修改而无需警告
:wa[ll]!    把所有修改的缓冲区写入磁盘
```

Tip 39：将工作区切分成窗口

```
<C-w>s
<C-w>v
:sp[lit] {filename}
:vsp[lit] {filename}
<C-w>w
<C-w>h
<C-w>j
<C-w>k
<C-w>l
:clo[se] 等价于 <C-w>c
:on[ly]  等价于 <C-w>o
<C-w>=
<C-w>_
<C-w>|
[N]<C-w>_
[N]<C-w>|
```

Tip 40：用标签页将窗口分组

```
:tabe[dit] {filename}
<C-w>T
:tabclose
:tabonly
:tabn[ext] {N} 等价于 {N}gt
:tabn[ext]     等价于 gt
:tabp[revious] 等价于 gT
```

Tip 41：用**:edit**命令打开文件

```
:pwd 打印Vim工作目录，注意和:!pwd的区别
:edit {file}
:edit %<Tab> %符号代表活动缓冲区的完整文件路径
:edit %:h<Tab> %:h扩展很厉害，可以为它创建一个映射项
```

Tip 42：使用**:find**打开文件

```
:find 命令允许我们通过文件名打开一个文件，但无需输入该文件的完整路径。前提是首先得配置'path'选项，如 :set path+=app/**
```

Tip 43：使用netrw管理文件系统

```
netrw是Vim发行版的标配插件，不需要额外安装任何东西，需要Vim已经被配置为可加载插件，也就是.vimrc里配置了

*set nocompatible*

*filetype plugin on*


:edit .    等价于 :e.    打开文件管理器，并显示当前工作目录
:Explore   等价于 :E     打开文件管理器，并显示活动缓冲区所在目录
:Sexplore
:Vexplore
<C-^>
```

Tip 44：把文件保存到不存在的目录中

```
这个技巧使用 **:!mkdir -p %:h** 来先创建目录，有点那啥...
```

Tip 45：以超级用户权限保存文件

```
:w[rite] !sudo tee % > /dev/null
%符号具有特殊含义，它会展开成当前文件的完整路径
```

Tip 46：让手指保持在本位行上

```
h j k l 键，不多说什么了...
尝试戒掉使用光标键的习惯，在.vimrc中把光标键设置成啥也不做
```

Tip 47：区分实际行与屏幕行

```
* wrap 设置启动时，每个超出窗口宽度的文本行会被回绕（折行）显示
* 要想知道实际行与屏幕行之间的不同，最简单的方法是启用number **:set nu**


j
gj
k
gk
g0
^
g^
$
g$
```

Tip 48：基于单词的移动

```
w    正向移动到下一单词的开头
b    反向移动到当前单词/上一单词开头
e    正向移动到当前单词/下一单词结尾
ge   方向移动到上一个单词到结尾

W
B
E
gE

理解单词和字符串到区别～
```

Tip 49：对字符进行查找

```
f{char} 在光标位置与当前行行尾之间查找指定对字符，如果找到了，就会把光标移动到此字符上；如果未找到，则保持光标不动。

; 正向重复查找
, 反向重复查找
f{char}
F{char}
t{char}
T{char}
```

Tip 50：通过查找进行移动

```
**/** 查找命令，这个最常用了！
查找命令不仅限于在普通模式下使用，我们也可以在可视模式及操作符待决模式中使用它
```

Tip 52：用精确的文本对象选择区

```
a) or ab
i) or ib
a} or aB
i} or iB
a]
i}
a>
i>
a'
i'
a"
i"
a`
i`
at
it
```

Tip 52：删除周边，修改内部

```
iw
aw
iW
aW
is
as
ip
ap

一般来说，d{motion}命令和aw、as、ap配合起来使用比较好，而c{motion}命令和iw及类似文本对象一起使用效果会更好。
```

Tip 53：设置位置标记，以便快速跳回

```
m{a-zA-Z} 命令会用选定字母标记当前光标所在位置
`{mark} 命令跳到位置标记所在行并把光标置于该行第一个非空白字符上
'{mark}

``    当前文件中上次跳转动作之前的位置
`.    上次修改的地方
`^    上次插入的地方
`[    上次修改或者复制的起始位置
`]    上次修改或者复制的结束位置
`<    上次高亮选择区的起始位置
`>    上次高亮选择区的结束位置
```

Tip 54：在匹配括号间跳转

```
% 命令允许我们在一组开、闭括号间跳转

matchit插件增强了%命令功能，可以在配对的关键字之间跳转。
**runtime macros/matchit.vim**
```

Tip 55：遍历跳转列表

```
:jumps    显示跳转列表
<C-o>
<C-i>

[count]G
/pattern<CR>/?pattern<CR>/n/N
%
(/)
{/}
H/M/L
gf
<C-]>
'{mark}/`{mark}
```

Tip 56：遍历改变列表

```
u
<C-r>

:changes 显示改变列表
g;
g,

`. 上次修改的位置
`^ 上次退出插入模式时光标所在位置 对应gi命令
```

Tip 57：跳转到光标下到文件

```
gf 命令
```

Tip 58：用全局位置标记在文件间快速跳转

```
m{letter} 命令允许我们在当前光标位置创建一个位置表姐
小写字母会创建局部于缓冲区到标记
大写字母会创建全局标记

`{letter}命令使光标快速回到标记所在处
```

Tip 59：用无名寄存器实现删除、复制于粘贴操作

```
xp
ddp
yyp
```

Tip 60：深入理解Vim寄存器

```
Vim不使用剪贴板到概念，为我们提供了多组寄存器
Vim的删除、复制于粘贴命令都会用到众多寄存器中的一个，我们可以通过给命令加"{register}前缀的方式指定要用到的寄存器，若不指明则使用无名寄存器。

Vim使用 delete、yank、put 术语
使用_d{motion}会执行真正的删除操作（不保持到寄存器）

如果没有指明要使用到寄存器，Vim默认使用无名寄存器，无名寄存器用双引号表示。
""p 等价于 p

复制专用寄存器 "0
:reg "0  检查复制专用寄存器

有名寄存器 "a to "z
使用小写字母引用有名寄存器，会覆盖该寄存器原有内容，而换用大写字母到话，则会将新到内容添加到该寄存器到原有内容之后

黑洞寄存器

系统剪贴板 "+
"+p
<C+r>+

选择专用寄存器 "*

表达式寄存器 "=

其它
"% 当前文件名
"# 轮换文件名
". 上次插入文本
": 上次执行的Ex命令
"/ 上次查找的模式
```

Tip 61：用寄存器中的内容替换高亮选区的文本

```
在可视模式下使用p命令时，Vim将用指定的寄存器内容来替换高亮选区中的文本
```

Tip 62：把寄存器的内容粘贴出来

```
面向行的复制或者删除操作，将创建面向行的寄存器；面向字符的复制或者删除操作，则创建面向字符的寄存器。
```

Tip 63：与系统剪贴板进行交互

```
:set paste    禁用所有插入模式下的映射项与缩进
:set paste!
为避免切换paste，使用"+寄存器
```

Tip 64：宏的读取与执行

```
q键既是「录制」按钮，也是「停止」按钮。
为了录制按键操作，一开需要q{register}，指定一个用于保存宏的寄存器。
通过@{register}命令执行指定寄存器的内容
用@@来重复最近调用过的宏
```

Tip 65：规范光标位置、直达目标以及中止宏

```
黄金法则：在录制一个宏时，要确保每条命令都可以被重复执行。
```

Tip 66：加次数回放宏

Tip 67：在连续的文本行上重复修改

Tip 68：给宏追加命令

```
如果之前的宏保存在寄存器"a中，可以使用qA在宏中追加命令
```

Tip 69：在一组文件中执行宏

```
:edit!
argdo normal @a
```

Tip 70：用迭代求值的方式给列表编号

```
参考这个操作
:let i=1
qa
I<C-r>=i<CR>)<Esc>
:let i+=1
q
```

Tip 71：编辑宏的内容

```
:put a 将宏粘贴到文档中
编辑宏
"add or :d a 将宏从文档复制回寄存器

:let @a=substitute(@a, '\~', 'vU', 'g')
```

Tip 72：调整查找模式对大小写敏感性

```
ignorecase 设置控制全局大小写敏感性
通过使用元字符\c与\C可以覆盖Vim默认的大小写敏感设置（\c会让查找模式忽略大小写，\C会强制区分大小写）
smartcase 设置会根据我们是否输入了大写字符来判断是否区分大小写
```

Tip 73：按正则表达式查找时，使用\v模式开关

```
利用\v模式开关来统一所有特殊符号规则，该元字符将会激活very magic搜索模式，即假定除_、大小写字母以及数字0到0之外到所有字符都具有特殊含义
```

Tip 74：按原义查找文本时，使用\V原义开关

Tip 75：使用圆括号捕获子匹配

```
任何圆括号内部的匹配文本都会被自动保存到一个临时仓库，可以使用\1、\2 一直到\9 引用每对()捕获到自匹配。
不论模式中是否使用了圆括号，元字符\0永远会引用整个匹配。
```

Tip 76：界定单词到边界

```
在very magic搜索模式下，用<和>符号表示单词定界符
可以将字符类\w、\W与匹配定界符\zs、\ze组合在一起来模拟<和>
可以在圆括号前加上%指示Vim不要将圆括号内容捕获给寄存器
```

Tip 77：界定匹配的边界

```
\zs \ze 的应用
```

Tip 78：转义问题字符

Tip 79：结识查找命令

```
:wrapscan 控制查找到文档结尾是否绕回
```

Tip 80：高亮查找匹配

```
:set hlsearch 控制高亮查找匹配 :set hls
:set nohlsearch 关闭 :set nohls
```

Tip 81：在执行查找前预览第一处匹配

```
:incsearch
<C-r><C-w> 查找补全
```

Tip 82：统计当前模式的匹配个数

```
:%s///gn  标志位n会抑制正常的替换动作，不过得注意不要掉了/符号避免预期之外的替换发生
```

Tip 83：将光标偏移到查找匹配到结尾

```
//e<CR>
```

Tip 84：对完整的查找匹配进行操作

```
介绍了textobj-lastpat插件，有点懵圈...
```

Tip 85：利用查找历史，迭代完成复杂的模式

Tip 86：查找当前高亮选区中的文本

Tip 87：结识substitute命令

```
:[range]s[ubstitute]/{pattern/{string}/[flags]

标志位
g 全局范围内执行
c 确认或拒绝每一处修改
n 抑制正常的替换行为
& 指示Vim重用上一次substitute命令所用过的标志位

替换中的一些特殊符号
\r
\t
\\
\1 \2 ...
\0
& 插入匹配模式的所有内容
~ 使用上一次调用:substitute时的{string}
\={Vim script} 执行{Vim script}表达式并将结果作为替换{string}
```

Tip 88：在文件范围内查找并替换每一处匹配

```
指定range 和 使用g 标志位。这个操作很常用。
```

Tip 89：手动控制每一次替换操作

```
使用 c 标志位
```

Tip 90：重用上次的查找模式

Tip 91：用寄存器的内容替换

Tip 92：重复上一次的substitute命令

```
g& 等价于 :%s//~/&

还有一个很厉害的实例!
```

Tip 93：使用子匹配重排CSV文件的字段

```
/\v^([^,]*),([^,]*),([^,]*)$
:%s//\3,\2,\1
```

Tip 94：在替换过程中执行算术运算

Tip 95：交换两个或更多的单词

Tip 96：在多个文件中执行查找与替换

```
这个真是666啊
```

Tip 97：结识global命令

```
:global命令允许我们在某个指定模式的所有匹配行上运行Ex命令。

:[range]global[!]/{pattern}/[cmd]
```

Tip 98：删除所有包含模式的文本行

Tip 99：将TODO项收集至寄存器

Tip 100：将CSS文件中所有规则的属性按照字母排序

Tip 101：结识ctags

```
安装ctags
brew install ctags
```
